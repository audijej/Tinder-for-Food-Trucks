<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="style.css">
  <title>Tinder for Food Trucks</title>
</head>

<body>

  <nav>
    <div class="nav-wrapper">
      <a href="#" class="brand-logo">Food Truck Tinder</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="foodtruck.html">Food Truck Vendors</a></li>
      </ul>
    </div>
  </nav>

  <div id="jumbotronHome"></div>


  <div class="body-container">
    <h1>FIND YOUR FAVORITE FOOD TRUCK</h1>
    <h2>Bringing Food Trucks and Foodies together</h2>

    <br>
    <h5>Finding your favorite food truck can now be as simple as launching the Food Truck
      Tinder app. All you simply have to do is search your favorite truck. You can
      also use your current location to see what trucks are around your area.</h5>

  </div>

  <div id="map"></div>

  


  <script>
    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.
    var map, infoWindow;
    function initMap() {
      infoWindow = new google.maps.InfoWindow;

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
// 
          console.log(pos)

          var image = 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png';
          var iconBase = 'http://maps.google.com/mapfiles/kml/paddle';

          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 17,
            center: pos
          });

          var point = new google.maps.Marker({
            position: pos,
            map: map,
            icon: image
          });

        // Event listener to get data from Tripadvisor when user clicks on map icon (marker);
          point.addListener('click', function () {
            infoWindow.open(map, point);
            getTripadvisor();
          });

          infoWindow.open(map);
          point.setMap(map);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function getTripadvisor() {

      navigator.geolocation.getCurrentPosition(function (position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
                
        //Variables to pull latitude and longitude;
        let lat = position.coords.latitude;
        let lng = position.coords.longitude;
        console.log(lat);
        console.log(lng);

        // Variable with Tripadvisor information for the ajax call;
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "https://tripadvisor1.p.rapidapi.com/restaurants/list-by-latlng?limit=30&currency=USD&distance=2&lunit=km&lang=en_US&latitude=" + lat + "&longitude=" + lon,
          "method": "GET",
          "headers": {
            "x-rapidapi-host": "tripadvisor1.p.rapidapi.com",
            "x-rapidapi-key": "xxx"
          }
        }
        // Ajax call to get response from Tripadvisor, including specific elements to relay on screen;
        $.ajax(settings).done(function (responseTripAdv) {
          console.log(responseTripAdv);
          console.log(window);
          let foodTruckName = responseTripAdv.data[0].name;
          let foodTruckRating = responseTripAdv.data[0].rating;
          let foodTruckWebsite = responseTripAdv.data[0].website;
          // $("#results").append("<h5>").text(foodTruckName);
        });
      });
    }


    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }

    //custom marker for food trucks: http://maps.google.com/mapfiles/kml/shapes/truck.png

    let myGoogleMapsAPI = "xxx";
    let myTripadvisorAPI = "xxx";
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3CWXAshpMiRrRXsGlLbIon7S5ZHAmjG4&callback=initMap"
    async defer></script>



  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-database.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyCPnQV0bMCM7T5Or9Z9j90rBE4u7a0QOGI",
      authDomain: "tinder-for-food-trucks.firebaseapp.com",
      databaseURL: "https://tinder-for-food-trucks.firebaseio.com",
      projectId: "tinder-for-food-trucks",
      storageBucket: "tinder-for-food-trucks.appspot.com",
      messagingSenderId: "602255825688",
      appId: "1:602255825688:web:02f921fa837b05930a5c6d",
      measurementId: "G-00BM15M1DV"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

  //       var locationsRef = firebase.database().ref("pos");
  // var bounds = new google.maps.LatLngBounds();
  // locationsRef.on('child_added', function(snapshot) {
  //   var data = snapshot.val();
  //   console.log(data);
  //   var marker = new google.maps.Marker({
  //     position: {
  //       lat: data.lat,
  //       lng: data.lng
  //     },
  //     map: map
  //   });
  //   bounds.extend(marker.getPosition());
  //   marker.addListener('click', (function(data) {
  //     return function(e) {
  //       infowindow.setContent(data.name + "<br>" + this.getPosition().toUrlValue(6) + "<br>" + data.message);
  //       infowindow.open(map, this);
  //     }
  //   }(data)));
  //   map.fitBounds(bounds);
  // });

  </script>




  <footer>
    <h4>Food Truck Tinder, Inc:</h4>
    <h4></h4>
    <h5>Max</h5>
    <h5>Kathryn</h5>
    <h5>Jesse</h5>
  </footer>

</body>

</html>